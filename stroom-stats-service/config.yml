database:
    driverClass: com.mysql.jdbc.Driver
    user: ${STATS_DB_USER:- stroomuser}
    password: ${STATS_DB_PASSWORD:- stroompassword1}
    url: ${STATS_DB_URL:- jdbc:mysql://localhost:3307/stroom?useUnicode=yes&characterEncoding=UTF-8}

    properties:
        charSet: UTF-8
        hibernate.dialect: org.hibernate.dialect.MySQLInnoDBDialect
        #set to false for compatibility with stroom's legacy hibernate 4 configuration and schema
        hibernate.id.new_generator_mappings: false
        hibernate.show_sql: false

    # the maximum amount of time to wait on an empty pool before throwing an exception
    maxWaitForConnection: 30s

    # the SQL query to run when validating a connection's liveness
    validationQuery: "/* MyApplication Health Check */ SELECT 1"

    # the minimum number of connections to keep open
    # Set this to 0 to prevent errors on startup if the DB hasn't started yet
    initialSize: 0

    # the minimum number of connections to keep open
    # Set this to 0 to prevent errors on startup if the DB hasn't started yet
    minSize: 0

    # the maximum number of connections to keep open
    maxSize: 50

    # whether or not idle connections should be validated
    checkConnectionWhileIdle: true

    #Whether or not connections will be validated before being borrowed from the pool.
    #If the connection fails to validate, it will be dropped from the pool, and another will be borrowed.
    checkConnectionOnBorrow: true

    #Whether or not connections will be validated before being added to the pool.
    #If the connection fails to validate, it wonâ€™t be added to the pool.
    checkConnectionOnConnect: true




jwtTokenSecret: ${STATS_JWT_SECRET:- CHANGE_ME}

server:
    adminMinThreads: 1
    adminMaxThreads: 10
    adminContextPath: ${ADMIN_CONTEXT_PATH:- /}
    applicationContextPath: /
    applicationConnectors:
        - type: http
          port: ${APPLICATION_PORT:- 8086}
    adminConnectors:
        - type: http
          port: ${ADMIN_PORT:- 8087}

logging:
    level: WARN
    loggers:
        org.hibernate.SQL: WARN
        stroom.stats: ${STATS_LOGGING_LEVEL:- DEBUG}
        io.dropwizard: ${STATS_LOGGING_LEVEL_DROPWIZARD:- INFO}
#        stroom.stats.streams.StatisticsAggregationProcessor: TRACE
#        stroom.stats.streams.FullEndToEndIT: TRACE
#        stroom.stats.hbase.table.HBaseEventStoreTable: TRACE
        org.ehcache: INFO
        org.eclipse.jetty: INFO
    appenders:
      - type: console
        logFormat: "%-6level [%d{HH:mm:ss.SSS}] [%t] %logger{5} - %X{code} %msg %n"
        target: stdout

zookeeper:
    # The quorum of zookeeper hosts to connect to
    # of the form host1:port1,host2:port2 etc.
    quorum: ${STATS_ZK_QUORUM:- localhost:2181}
    # The path to chroot the zookeeper connection for the property service
    propertyServicePath: ${STATS_SK_PROPERTY_SERVICE_PATH:- /propertyService}
    # Timeout for waiting for initialisation of the property service tree cache
    propertyServiceTreeCacheTimeoutMs: 60000
    # The path to use for service discovery
    serviceDiscoveryPath: ${STATS_ZK_SD_PATH:- /stroom-services}

kafka:
    groupId: stroom-service
    statisticsTopic: statistics

# These properties prime ZK - and once they've been set changing the below won't change the values.
defaultProperties:
    stroom.stats.streams.kafka.bootstrapServers: ${STATS_KAFKA_BOOTSTRAP:- localhost:9092}
    stroom.stats.streams.kafka.num.stream.threads: 2
    stroom.stats.streams.kafka.commit.aggregationInterval.ms: 30000
    stroom.stats.streams.kafka.num.stream.threads: 2
    stroom.stats.streams.flatMapProcessorAppIdPrefix: FlatMapProcessor

    stroom.stats.topics.statisticEventsPrefix: statisticEvents
    stroom.stats.topics.badStatisticEventsPrefix: badStatisticEvents
    stroom.stats.topics.statisticRollupPermsPrefix: statisticRollupPerms

    stroom.stats.aggregation.processorAppIdPrefix: AggregationProcessor
    stroom.stats.aggregation.threadsPerIntervalAndType: 2
    stroom.stats.aggregation.minBatchSize: 100000
    stroom.stats.aggregation.maxFlushIntervalMs: 10000
    stroom.stats.aggregation.maxEventIds: 100
    stroom.stats.aggregation.pollTimeoutMs: 100
    stroom.stats.aggregation.pollRecords: 5000
    stroom.stats.aggregation.autoOffsetRest: latest

    stroom.stats.cache.nameToStatisticConfigurationCache.maxEntriesHeap: 1000
    stroom.stats.cache.uuidToStatisticConfigurationCache.maxEntriesHeap: 1000
    stroom.stats.cache.nameToUidCache.maxEntriesHeap: 100000
    stroom.stats.cache.nameToUidCache.timeToIdleSecs: 300
    stroom.stats.cache.uidToNameCache.maxEntriesHeap: 100000
    stroom.stats.cache.uidToNameCache.timeToIdleSecs: 300

    stroom.stats.hbase.config.client.write.buffer: 4194304
    stroom.stats.hbase.config.rpc.timeout: 180000
    stroom.stats.hbase.config.zookeeper.property.clientPort: 2181
    stroom.stats.hbase.config.zookeeper.quorum: ${STATS_HBASE_ZK_QUORUM:- localhost}
    stroom.stats.hbase.dataStore.maxCheckAndPutRetries: 5
    stroom.stats.hbase.dataStore.purge.intervalsToRetain.day: 6
    stroom.stats.hbase.dataStore.purge.intervalsToRetain.hour: 39
    stroom.stats.hbase.dataStore.purge.intervalsToRetain.minute: 60
    stroom.stats.hbase.dataStore.purge.intervalsToRetain.second: 48
    stroom.stats.hbase.search.maxTimeIntervalsInPeriod: 200

    #If set registers this instance with service discovery using the specified address,
    #else it uses the local hostname or ip address
    #stroom.stats.serviceDiscovery.servicesHostNameOrIpAddress:
    #As above but for port
    #stroom.stats.serviceDiscovery.servicesPort:

    #----------Service Discovery START ---------------
    #Stroom-Stats
    stroom.services.stroomStats.name: stroom-stats
    stroom.services.stroomStats.version: 1
    stroom.services.stroomStats.docRefType: StroomStatsStore
    #Stroom-Index
    stroom.services.stroomIndex.name: stroom-index
    stroom.services.stroomIndex.version: 1
    stroom.services.stroomIndex.docRefType: Index
    #authentication
    stroom.services.authentication.name: authentication
    stroom.services.authentication.version: 1
    #authorisation
    stroom.services.authorisation.name: authorisation
    stroom.services.authorisation.version: 1
    #----------Service Discovery END -----------------


