# Basic configuration
language: java
dist: trusty
group: edge
jdk: openjdk8
#this is needed for using the docker daemon
sudo: required

env:
  global:
    # $TAGPERM environment variable
    # generate a token at https://github.com/settings/tokens and encrypt it
    # with `travis encrypt TAGPERM=<yoursecrettoken>`
    # also see: https://docs.travis-ci.com/user/encryption-keys/#Usage
    # and: https://docs.travis-ci.com/user/best-practices-security/
    - secure: "eEYzUNi44hdz7dfoLaJrajAEQNVqFoOnuBQvsUJkQlIciQp+69wJ4dFZOzsOrcDILwU11s05YbSqkQ3zGqkQfIRlwO45yHLvmjgPyk3DUxgF3fJytlCBxU90iZKQNBfhbgooXbpYpHLv6OHxU9JYQLeVY6LiY+4POPzfDqOIvCqFaJHNkM54TUtVMWI4lGHN1pNco98vlnrXOscyVLre8Of6X7skGlKt5v8im777wgaTQiF04HawUFSdUfEIBkSMyE76TCS9ifeNvg9ro6XwTZiiMfchavdPTQtj8+VvSoCIghuPdx7nGENuEKtwqwPHKdjNMA1ApX5wG8M2/sQG3ZmIorXk+oj/27RO7LkEcV3A9Uu1XqQAWE79PlHQQzuPZ9YNBuN5zYtOeHhqvpDkd48XjD79IZB7TqC8yI8Pzx6TV+1PVqfF3nncsUcv+2/HN5jjLMiogqynI//Mb2mrb5QZsZmxEZpi6P+tKuFNmm7+TyDYBRkT1YgEvW4Mzjemp0PufzdBr4Yo/ATOhfZw+xFhjeo6dWrb6+0qDcZB5aNVNB8LR48Hox/VCQJh4Eic59J7GEnqfDv1cX5/lwClJW1HrFPlptVm7EHRXZgw9cA1VNNGvG8qDERRjk1Jd/3cv/Sh3Pyfc5joNOjmKWiPNCoUciRcaz0cYLBjuznNq3c=" 

install: echo "skip 'gradle assemble' step to speed up build"

before_script: ./travis.before_script.sh

# We need to run shadowJar otherwise we won't be able to publish to DockerHub
script: ./travis.script.sh

# Push to GitHub releases - the key was generated by the Travis CLI.
deploy:
  provider: releases
  api_key:
    secure: aDEYP6/O0zYQKPND9fVwpwgB32fS2K9ImJSqUdRzgCnkC7jYHxnG/KZUs/Zs9F/D/GblpahreUH/zuw3iOwE5w8df/rFMPyx0Mr0bhO0e7yQAElpLYl5Xk5T+iwTdZcgUQb64rPnAg0axgic3mlXzJN19tB2NjTK+qsKmBhOqRdwv/R23hJlq+0+4z4vTJgRRbqLAJ6zz8aziZoGzPz87VrXGIUiP6pziHVopnnIAF2LAtOl0s3g5GuWYicdI9510DXB1BSA+NjeSk79BP2Tot/vLuHcdVWooDQuU2ABaFwMhCuOlmRARKUkC4VCPbA2XqhtmpfS5e4w5oMFxif35C+lPWgcG5ERTlSR9PQtuqE30hW4RhQTIw9YKYcmeh5jIRZVPPPeUs4bzEfN5qjFYjEs5Uf2DS6OqLOjbLHsfjfMqXUBgb11OJNxziIbnZqhE9fNsjMXGF2S1BG0rJWVno+AUun7HNZRGp0R+2z37eNXtoOMxX6FCbmjgxWJfzlBihsS4tzIUBPwHZ6XjL5O5bIqwb2PCFevmTkHHj3nBMi6gDFjgOCE0TmNdlWGqVYqGBEbnnC4idMaT8guWopCfK8VJ447jSKEA+bP/zrO5dcDTD9LQ+Ib6BUM5F8gJusEowX/ex+ngE+d0iAT6MIcydS5Ki1Of3x3dKc5txMDNTc=
  file_glob: true
  file: 
    - stroom-stats-service/build/libs/*-all.jar
    - stroom-stats-hbase-filter/build/libs/*-all.jar
    - stroom-stats-schema/build/libs/*.jar
  skip_cleanup: true
  on:
    tags: true

#clean out gradle caches as per travis docs
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

# Cache dependencies to speed up the build
cache:
  directories:
    - .autoconf
    - $HOME/.m2
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
